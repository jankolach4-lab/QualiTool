name: Android APK (Capacitor)

on: workflow_dispatch:

jobs: build-apk: runs-on: ubuntu-latest defaults: run: working-directory: frontend steps: - name: Checkout uses: actions/checkout@v4

  - name: Setup Node
    uses: actions/setup-node@v4
    with:
      node-version: '18'

  - name: Install dependencies
    run: |
      yarn install --frozen-lockfile || yarn install
      # Sicherstellen, dass Capacitor verf√ºgbar ist (idempotent)
      yarn add @capacitor/core@^6 || true
      yarn add -D @capacitor/cli@^6 @capacitor/android@^6 || true

  - name: Build web assets
    run: yarn build

  - name: Setup Java 17
    uses: actions/setup-java@v4
    with:
      distribution: 'temurin'
      java-version: '17'

  - name: Setup Android SDK
    uses: android-actions/setup-android@v3

  - name: Show Capacitor version
    run: npx cap --version || true

  - name: Add Android platform (idempotent)
    run: npx cap add android || echo 'Android platform already present'

  - name: Sync Android platform
    run: npx cap sync android

  - name: Grant execute permission for Gradle
    run: |
      cd android
      chmod +x ./gradlew

  - name: Build Debug APK
    run: |
      cd android
      ./gradlew assembleDebug --no-daemon --stacktrace

  - name: Upload APK artifact
    uses: actions/upload-artifact@v4
    with:
      name: qualitool-debug-apk
      path: android/app/build/outputs/apk/debug/app-debug.apk
      if-no-files-found: error
